<!doctype html>
<html lang="en" data-version="{{ uuid }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NullTrace • Quantum-ready E2EE Chat</title>
  <meta name="description" content="NullTrace — quantum-ready, RAM-only group chat with hybrid X25519 + ML-KEM, deterministic AEAD, traffic shaping, and zero telemetry.">
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#0d0f14">
  <link rel="icon" href="{{ url_for('static', path='logo.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">

  <script type="importmap" nonce="{{ request.state.csp_nonce }}">
  {
    "imports": {
      "libsodium-wrappers": "https://esm.sh/libsodium-wrappers@0.7.15?bundle",
      "mlkem":              "https://esm.sh/mlkem@2.3.1?bundle",
      "handshake":          "/static/js/modules/handshake.js?v={{ uuid }}",
      "group":              "/static/js/modules/group.js?v={{ uuid }}",
      "mls":                "/static/js/modules/mls.js?v={{ uuid }}",
      "nacp":               "/static/js/modules/nacp.js?v={{ uuid }}"
    }
  }
  </script>
</head>
<body>
  <main class="container">

    <header class="topbar" role="banner">
      <div class="brand">
        <img src="{{ url_for('static', path='logo.png') }}" class="logo" alt="NullTrace" decoding="async">
        <div class="brand-copy">
          <h1 class="app-title">NullTrace</h1>
          <p class="app-sub">Quantum-ready · RAM-only · Zero telemetry</p>
        </div>
      </div>
      <div class="status-badges" aria-label="Status">
        <span class="badge">E2EE</span>
        <span class="badge">PQ-Hybrid</span>
        <span class="badge">No Logs</span>
        <span id="status" class="badge badge-live" aria-live="polite"></span>
      </div>
    </header>

    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-card">
        <h2 id="hero-title">Private rooms. Disposable identities.</h2>
        <p class="muted">Start a secure channel, invite with a one-time capsule, let messages auto-burn.</p>

        <div class="quick-actions">
          <label for="room" class="visually-hidden">Secure Channel</label>
          <input
            id="room"
            class="room-input"
            inputmode="latin"
            autocomplete="off"
            spellcheck="false"
            placeholder="Secure Channel">
          <div class="actions">
            <button id="join" class="btn primary" type="button">Start</button>
            <button id="capsuleBtn" class="btn" type="button">Join</button>
            <button id="inviteBtn" class="btn ghost" type="button" disabled>Invite</button>
          </div>
        </div>

        <ul class="hero-points" aria-label="Highlights">
          <li>Post-quantum hybrid keying</li>
          <li>Traffic shaping with chaff &amp; padding</li>
          <li>Burn timer · Deadman · One-tap wipe</li>
        </ul>
      </div>
    </section>

    <section class="pending" aria-labelledby="pending-title">
      <h3 id="pending-title" class="visually-hidden">Pending approvals</h3>
      <ul id="pendingList" class="pending-list"></ul>
    </section>

    <section class="grid" aria-label="Chat area">
      <div class="chat-shell">
        <ul id="messages" class="chat" aria-live="polite" aria-relevant="additions"></ul>
      </div>

      <aside class="roster" aria-labelledby="roster-title">
        <div class="roster-head">
          <h3 id="roster-title">Participants</h3>
          <p class="muted small">Approve newcomers · verify fingerprints</p>
        </div>
        <div id="userList" class="user-list" role="list"></div>
      </aside>
    </section>

    <section class="bottom-bar" aria-label="Compose">
      <div class="compose">
        <label for="input" class="visually-hidden">Message</label>
        <input
          id="input"
          class="compose-input"
          placeholder="Type your secure message…"
          disabled
          autocomplete="off"
          spellcheck="false">
        <button id="send" class="btn primary" type="button" disabled>Send</button>
      </div>
      <div class="controls">
        <button id="disconnectBtn" class="btn danger" type="button" disabled title="Wipe session">Wipe</button>
        <label class="deadman-label" for="deadmanToggle" title="Hide tab &gt; 2 s to wipe">
          <input type="checkbox" id="deadmanToggle">
          Deadman
        </label>
      </div>
    </section>

    <section class="features" aria-labelledby="engine-title">
      <h2 id="engine-title">Security Engine</h2>

      <div class="feature-grid">
        <div class="feature">
          <h4>PQ-Hybrid from day one</h4>
          <p>X25519 + ML-KEM-512 for long-term secrecy and post-quantum resilience.</p>
        </div>

        <div class="feature">
          <h4>Identity-bound pairing</h4>
          <p>Signed handshake transcript + short SAS check to block invisible MITM.</p>
        </div>

        <div class="feature">
          <h4>Replay-proof AEAD</h4>
          <p>XChaCha20-Poly1305 with per-sender sequence &amp; epochs. Strict AAD binds sender/seq/epoch.</p>
        </div>

        <div class="feature">
          <h4>Smart rekey</h4>
          <p>Initiator-driven on join/leave. Per-peer sealed GK distribution.</p>
        </div>

        <div class="feature">
          <h4>Access capsules</h4>
          <p>NT-C1 invites: signed, TTL-locked, size-padded. One-time room tokens at the WS edge.</p>
        </div>

        <div class="feature">
          <h4>Traffic shaping</h4>
          <p>Uniform 3–5 KB frames; encrypted chaff; server sinks noise.</p>
        </div>

        <div class="feature">
          <h4>Soft rate limits</h4>
          <p>Per-class quotas (chat / control / bulk). Back-pressure without drops.</p>
        </div>

        <div class="feature">
          <h4>RAM-only</h4>
          <p>No persistence. No telemetry. Hardened headers &amp; strict CSP.</p>
        </div>

        <div class="feature">
          <h4>Safety UX</h4>
          <p>Approvals, SAS verify, burn timer, deadman switch, one-tap wipe.</p>
        </div>
      </div>
    </section>

    <section class="features" aria-labelledby="how-title">
      <h2 id="how-title">How it works</h2>

      <ol class="how-list">
        <li><strong>Host starts a room.</strong> Fresh keys; disposable room ID.</li>
        <li><strong>Share an invite capsule.</strong> Signed NT-C1, TTL-bound, size-padded (no token inside).</li>
        <li><strong>Guest pastes &amp; confirms.</strong> Room + short SAS fingerprints for a quick human check.</li>
        <li><strong>Hybrid handshake.</strong> X25519 + ML-KEM derive a shared secret; initiator signs the transcript.</li>
        <li><strong>Host approves.</strong> Sends one-shot <code>ct</code>; rekeys and distributes sealed GK.</li>
        <li><strong>Chat.</strong> AEAD with deterministic nonces; AAD over <code>{type,cid,seq,epoch}</code>.</li>
        <li><strong>Membership change → new keys.</strong> Debounced rekey; guests can <code>gk_req</code> to resync.</li>
        <li><strong>Traffic blended.</strong> Frames padded; encrypted chaff runs; server sinks noise.</li>
        <li><strong>Clean exit.</strong> Burn timer, deadman, wipe. Nothing at rest.</li>
      </ol>
    </section>

  </main>

  <dialog id="inviteDlg" class="dlg" aria-labelledby="invite-title">
    <h3 id="invite-title">Share capsule</h3>
    <p class="muted small">Expires in <span id="inviteTimer">02:00</span></p>
    <textarea id="inviteTxt" readonly class="mono" rows="5"></textarea>
    <div class="dlg-buttons">
      <button id="inviteCloseBtn" class="btn" type="button">Close</button>
    </div>
  </dialog>

<dialog id="pasteDlg" class="dlg" aria-labelledby="paste-title">
  <h3 id="paste-title">Paste capsule</h3>
  <textarea id="pasteTxt" class="mono" rows="5" placeholder="Paste NT-C1 capsule here…"></textarea>
  <div class="dlg-buttons">
    <button id="pasteOk" class="btn primary" type="button">OK</button>
    <button id="pasteCancelBtn" class="btn" type="button">Cancel</button>
  </div>
</dialog>


  <dialog id="confirmDlg" class="dlg" aria-labelledby="confirm-title">
    <h3 id="confirm-title">Confirm Join</h3>
    <div class="confirm-grid" role="group" aria-label="Confirmation">
      <p>Room: <strong><span id="confirmRoom"></span></strong></p>
      <p>Host ID: <code id="confirmHostFP"></code></p>
      <p>Your ID: <code id="confirmGuestFP"></code></p>
    </div>
    <div class="dlg-buttons">
      <button id="confirmJoinBtn" class="btn primary" type="button">Join</button>
      <button id="confirmCancelBtn" class="btn" type="button">Cancel</button>
    </div>
  </dialog>

<dialog id="accessDlg" class="dlg" aria-labelledby="access-title" aria-describedby="access-desc">
  <h3 id="access-title">Welcome to NullTrace (Beta)</h3>
  <p id="access-desc" class="muted small">
    We’re currently in closed beta. Access is available with an access code.
    You can obtain one by backing the project on
    <a href="https://kickstarter.example/fulllinkher" rel="noopener">Kickstarter</a>.
  </p>

  <label for="accessInput" class="visually-hidden">Access code</label>
  <input
    id="accessInput"
    class="mono"
    type="password"
    inputmode="latin"
    autocomplete="off"
    spellcheck="false"
    placeholder="Enter your access code…">

  <p id="accessErr" class="small muted" role="status" aria-live="polite" style="min-height:1.2em"></p>

  <div class="dlg-buttons">
    <button id="accessOk" class="btn primary" type="button">Continue</button>
  </div>
</dialog>


  <noscript>
    <p class="muted small" style="text-align:center;margin:1rem 0;">
      JavaScript is required for end-to-end encryption.
    </p>
  </noscript>

  <script type="module" src="{{ url_for('static', path='js/app.js') }}?v={{ uuid }}"></script>
</body>
</html>
